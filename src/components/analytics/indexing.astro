<script client:load>

document.addEventListener('DOMContentLoaded', () => {
    const textInput = document.getElementById('google-indexer-input');
    const resultOutput = document.getElementById('google-indexer-text-output');
    let debounceTimeout;

    textInput.addEventListener('input', () => {
        const url = textInput.value.trim();
        clearTimeout(debounceTimeout);

        debounceTimeout = setTimeout(() => {
            if (!url) {
                resultOutput.textContent = 'Hãy nhập URL hợp lệ.';
                return;
            }
            submitToGoogleIndexAPI(url);
        }, 1000);
    });

    async function submitToGoogleIndexAPI(url) {
        resultOutput.textContent = 'Đang gửi URL lên Google Index API...';

        try {
            const response = await fetch('http://localhost:3000/index-url', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url })
            });

            const result = await response.json();
            if (response.ok) {
                resultOutput.textContent = `Thành công: ${JSON.stringify(result)}`;
            } else {
                resultOutput.textContent = `Lỗi: ${JSON.stringify(result)}`;
            }
        } catch (error) {
            resultOutput.textContent = `Lỗi kết nối: ${error.message}`;
        }
    }
});

</script>
