---
import Button from '~/components/ui/button.astro';
import CTA from '~/components/widgets/services.astro';
---

<section class="relative md:-mt-[76px] not-prose">
	<div class="absolute inset-0 pointer-events-none" aria-hidden="true"></div>
		<div class="pt-0 md:pt-[120px] pointer-events-none"></div>
			<h1 class="mx-auto max-w-7xl md:px-6 leading-tighter text-center text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-6 font-heading">
					Chat AI Cá Nhân
				</h1>

			<div class="mx-auto max-w-7xl md:px-6 px-4">

				<textarea id="input" placeholder="Nhập câu hỏi của bạn..." class="px-4 mb-6 py-6 block w-full text-md rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900" required></textarea>

				<button id="convert-btn" class="btn-primary w-auto mb-6">Gửi</button>

				<div id="output" class="mb-6 text-lg border border-gray-300 p-4 rounded-lg"></div>

			</div>

			<script client:load>
				document.addEventListener("DOMContentLoaded", function () {
					const buttonConvert = document.getElementById('convert-btn');
					const input = document.getElementById('input');
					const output = document.getElementById('output');

					buttonConvert.addEventListener('click', async function () {
						const inputText = input.value.trim();
						if (!inputText) {
							output.innerText = "Vui lòng nhập nội dung.";
							return;
						}

						// Cấu hình API
						const API_KEY = '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';
						const endpoint = 'https://api.openai.com/v1/chat/completions';

						output.innerText = "Đang xử lý...";

						try {
							const response = await fetch(endpoint, {
								method: 'POST',
								headers: {
									'Content-Type': 'application/json',
									'Authorization': `Bearer ${API_KEY}`
								},
								body: JSON.stringify({
									model: "gpt-4",
									messages: [
										{ role: "user", content: inputText }
									],
									max_tokens: 200,
									temperature: 0.7
								})
							});

							if (response.ok) {
								const result = await response.json();
								const aiResponse = result.choices[0].message.content;
								output.innerText = aiResponse;
							} else {
								const errorData = await response.json();
								output.innerText = `Lỗi từ máy chủ: ${errorData.error.message}`;
							}
						} catch (error) {
							console.error('Error:', error);
							output.innerText = 'Không thể kết nối với máy chủ. Vui lòng thử lại sau.';
						}
					});
				});
			</script>
		</div>
</section>
