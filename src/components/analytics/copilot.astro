---
import Button from '~/components/ui/button.astro';
import CTA from '~/components/widgets/services.astro';
---

<section class="relative md:-mt-[76px] not-prose">
	<div class="absolute inset-0 pointer-events-none" aria-hidden="true"></div>
		<div class="pt-0 md:pt-[120px] pointer-events-none"></div>
			<h1 class="mx-auto max-w-7xl md:px-6 leading-tighter text-center text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-6 font-heading">
					Chat AI Cá Nhân
				</h1>

			<div class="mx-auto max-w-7xl md:px-6 px-4">

				<textarea id="input" placeholder="Nhập câu hỏi của bạn…" class="px-4 mb-6 py-6 block w-full text-md rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900" required></textarea>

				<button id="convert-btn" class="btn-primary w-auto mb-6">Gửi</button>

				<div id="output" class="mb-6 text-lg border border-gray-300 p-4 rounded-lg"></div>

			</div>

			<script client:load>
				document.addEventListener("DOMContentLoaded", function () {
					// ... (other code remains the same)

					try {
						const response = await fetch(endpoint, {
							// ...
						});

						if (!response.ok) {
							const error = await response.text();
							try { // Try to parse JSON for a better error message
								const errorJSON = JSON.parse(error);
								if (errorJSON.error && errorJSON.error.message) {
									output.innerText = `Lỗi từ máy chủ: ${errorJSON.error.message}`;
								} else {
										output.innerText = `Lỗi từ máy chủ.`;
								}
							} catch (parseError) {
								output.innerText = `Lỗi từ máy chủ.`;
								console.error("Could not parse error response as JSON:", parseError);
							}
							console.error('Error response:', response.status, error);
							return;
						}

						const result = await response.json();
						const aiResponse = result.candidates[0].content;

						if (typeof aiResponse === 'string') {
							output.innerText = aiResponse;
						} else if (typeof aiResponse === 'object' && aiResponse !== null) {
							if (aiResponse.hasOwnProperty('text')) {
								output.innerText = aiResponse.text;
							} else {
								output.innerText = JSON.stringify(aiResponse, null, 2); // Fallback to JSON stringify
							}
						} else {
							output.innerText = "Định dạng phản hồi không được hỗ trợ.";
						}

					} catch (error) {
						// ...
					}
				});
			</script>
		</div>
</section>