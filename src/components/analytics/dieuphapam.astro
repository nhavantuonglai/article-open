---
import Button from '~/components/ui/button.astro';
import CTA from '~/components/widgets/services.astro';
---

<section class="relative md:-mt-[76px] not-prose">
  <div class="absolute inset-0 pointer-events-none" aria-hidden="true"></div>
  <div class="pt-0 md:pt-[120px] pointer-events-none"></div>
  <h1 class="mx-auto max-w-7xl md:px-6 leading-tighter text-center text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-6 font-heading">
    dieuphapam
  </h1>

  <div class="mx-auto max-w-7xl md:px-6 px-4">
    <textarea id="input" placeholder="Nhập URL trang chứa các liên kết tải…" class="px-4 mb-6 py-6 block w-full text-md rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900" required></textarea>

    <button id="convert-btn" class="btn-primary w-auto mb-6">Gửi yêu cầu</button>

    <div id="output" class="mb-6 text-lg border border-gray-300 p-4 rounded-lg"></div>
  </div>

<script client:load>
	function processURL(input) {
	  // Bước 1: Tách số ID từ URL đầu vào
	  const idMatch = input.match(/\d+$/);
	  if (!idMatch) {
		console.error("Không tìm thấy ID trong URL");
		return;
	  }
	  const id = idMatch[0];

	  // Bước 2: Tạo URL mới
	  const newURL = `https://media.dieuphapam.net/portal/download.php?f=${id}.dieuphapam.list`;

	  // Bước 3: Fetch dữ liệu từ URL mới (giả sử đây là một API trả về danh sách link)
	  fetch(newURL)
		.then(response => {
		  if (!response.ok) {
			throw new Error(`Lỗi khi fetch dữ liệu: ${response.status}`);
		  }
		  return response.json(); // Giả sử dữ liệu trả về dạng JSON
		})
		.then(data => {
		  // Bước 4: Hiển thị danh sách link
		  const resultElement = document.getElementById('result');
		  resultElement.innerHTML = ''; // Xóa nội dung cũ
		  data.forEach(link => {
			const a = document.createElement('a');
			a.href = link;
			a.textContent = link;
			resultElement.appendChild(a);
		  });
		})
		.catch(error => {
		  console.error('Lỗi:', error);
		  const resultElement = document.getElementById('result');
		  resultElement.textContent = 'Có lỗi xảy ra, vui lòng thử lại sau.';
		});
	}

	// Ví dụ sử dụng hàm
	const input = 'https://dieuphapam.net/dpa/toi-la-ai-mot-phuong-phap-hanh-thien.4257/';
	processURL(input);
</script>







</section>