---
import ApexCharts from 'apexcharts';
---

<h2 class="mx-auto max-w-7xl md:px-6 leading-tighter text-center text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-6 font-heading">Thống kê lưu lượng dữ liệu</h2>

<div id="main-chart" class="relative mx-auto max-w-7xl mb-6"></div>

<script>

	import ApexCharts from 'apexcharts';

	const getMainChartOptions = () => {
		const isDarkMode = document.documentElement.classList.contains('dark');
		const mainChartColors = {
			borderColor: isDarkMode ? '#374151' : '#F3F4F6',
			labelColor: isDarkMode ? '#9CA3AF' : '#6B7280',
			opacityFrom: isDarkMode ? 0 : 0.45,
			opacityTo: isDarkMode ? 0.15 : 0,
		};

		return {
			chart: {
				height: 500,
				type: 'area',
				foreColor: mainChartColors.labelColor,
				toolbar: {
					show: false,
				},
			},

			fill: {
				type: 'gradient',
				gradient: {
					enabled: true,
					opacityFrom: mainChartColors.opacityFrom,
					opacityTo: mainChartColors.opacityTo,
				},
			},

			dataLabels: {
				enabled: false,
			},

			tooltip: {
				style: {
					fontSize: '14px',
				},
			},

			grid: {
				show: true,
				borderColor: mainChartColors.borderColor,
				strokeDashArray: 1,
				padding: {
					left: 35,
					bottom: 15,
				},
			},

			series: [
				{
					name: 'Bandwidth',
					data: [249, 332, 738, 827, 440, 591, 642, 758, 1039],
					color: '#ff725e',
				},
				{
					name: 'Edge requests',
					data: [241, 353, 639, 845, 475, 641, 695, 605, 933],
					color: '#1a56db',
				},
			],

			xaxis: {
				categories: [
					'Apr 2024',
					'May 2024',
					'Jun 2024',
					'Jul 2024',
					'Aug 2024',
					'Sep 2024',
					'Oct 2024',
					'Nov 2024',
					'Dec 2024',
				],
				labels: {
					style: {
						colors: [mainChartColors.labelColor],
						fontSize: '14px',
						fontWeight: 500,
					},
				},
				axisBorder: {
					color: mainChartColors.borderColor,
				},
				axisTicks: {
					color: mainChartColors.borderColor,
				},
				crosshairs: {
					show: true,
					position: 'back',
					stroke: {
						color: mainChartColors.borderColor,
						width: 1,
						dashArray: 10,
					},
				},
			},

			yaxis: {
				labels: {
					style: {
						colors: [mainChartColors.labelColor],
						fontSize: '14px',
						fontWeight: 500,
					},
					formatter(value) {
						return `${value}`;
					},
				},
			},

			legend: {
				fontSize: '14px',
				fontWeight: 500,
				labels: {
					colors: [mainChartColors.labelColor],
				},
				itemMargin: {
					horizontal: 10,
				},
			},

			responsive: [
				{
					breakpoint: 1024,
					options: {
						xaxis: {
							labels: {
								show: false,
							},
						},
					},
				},
			],
		};
	};

	if (document.getElementById('main-chart')) {
		const chart = new ApexCharts(
			document.getElementById('main-chart'),
			getMainChartOptions()
		);
		chart.render();

		document.addEventListener('dark-mode', () => {
			chart.updateOptions(getMainChartOptions());
		});
	}

</script>

<style is:global>

	.apexcharts-tooltip {
		@apply bg-white dark:bg-gray-700 text-gray-500 dark:text-gray-400 border-0 rounded-lg shadow-lg !important;
	}

	.apexcharts-tooltip .apexcharts-tooltip-title {
		@apply py-2 px-4 bg-gray-100 dark:bg-gray-600 border-b border-gray-200 dark:border-gray-500 !important;
	}

	.apexcharts-xaxistooltip {
		@apply text-gray-500 border-0 bg-white dark:bg-gray-700 dark:text-gray-300 rounded-lg shadow-lg !important;
	}

	.apexcharts-tooltip .apexcharts-tooltip-text-y-value {
		@apply dark:text-white;
	}

	.apexcharts-xaxistooltip-text {
		@apply font-medium text-sm !important;
	}

	.apexcharts-xaxistooltip:before,
	.apexcharts-xaxistooltip:after {
		@apply border-0 !important;
	}

</style>